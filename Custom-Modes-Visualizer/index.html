<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>custom-modes-visualizer</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>

    <!-- Custom Ko-fi Floating Donation Button with delayed loading, auto-hide, and close button -->
    <script>
      setTimeout(function() {
        // Dynamically load Ko-fi script after 30 seconds to avoid immediate impact on page load
        var script = document.createElement('script');
        script.src = 'https://storage.ko-fi.com/cdn/scripts/overlay-widget.js';
        script.onload = function() {
          // Draw the widget with customized text and explicit right positioning
          kofiWidgetOverlay.draw('jamescherished', {
            'type': 'floating-chat',
            'floating-chat.donateButton.text': 'Thank me!',
            'floating-chat.donateButton.background-color': '#00b9fe',
            'floating-chat.donateButton.text-color': '#fff',
            'floating-chat.position': 'Right'
          });

          // Wait for widget to render, then add close button and auto-hide timer
          setTimeout(function() {
            // Find the widget container (Ko-fi typically adds a div with class containing 'kofi')
            var widget = document.querySelector('.kofi-overlay') ||
                         document.querySelector('[class*="kofi"]') ||
                         document.querySelector('div[style*="position: fixed"]'); // Fallback for fixed position elements

            if (widget) {
              // Force right-side positioning with high-specificity CSS override
              widget.style.cssText += `
                right: 20px !important;
                left: auto !important;
                position: fixed !important;
                z-index: 9999 !important;
              `;

              // Create close button positioned over the widget (right-side positioning enforced)
              var closeBtn = document.createElement('div');
              closeBtn.innerHTML = 'Ã—';
              closeBtn.style.cssText = `
                position: fixed !important;
                top: 10px !important;
                right: 10px !important;
                background: rgba(0, 0, 0, 0.7);
                color: #fff;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                z-index: 10001 !important;
                font-size: 20px;
                font-weight: bold;
                user-select: none;
              `;
              closeBtn.title = 'Close donation widget';
              closeBtn.onclick = function() {
                widget.style.display = 'none';
                closeBtn.remove();
              };
              document.body.appendChild(closeBtn);

              // JavaScript fallback: Check positioning after a short delay and force right-side if needed
              setTimeout(function() {
                var rect = widget.getBoundingClientRect();
                if (rect.left < window.innerWidth / 2) {
                  // Widget is on left side, force right positioning
                  widget.style.right = '20px';
                  widget.style.left = 'auto';
                  closeBtn.style.right = '10px';
                  closeBtn.style.left = 'auto';
                }
              }, 1500); // Check after 1.5 seconds to allow for initial layout

              // Auto-hide after 30 seconds of display
              setTimeout(function() {
                widget.style.display = 'none';
                closeBtn.remove();
              }, 30000);
            }
          }, 1000); // Wait 1 second for widget to fully render
        };
        document.head.appendChild(script);
      }, 30000); // 30-second delay before loading
    </script>
  </body>
</html>
